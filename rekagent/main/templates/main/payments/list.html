{% extends "main/base.html" %}
{% block title %}–ü–ª–∞—Ç–µ–∂–∏{% endblock %}
{% block content %}
<h2>{% if user.profile.role == 'client' %}–ú–æ–∏ –ø–ª–∞—Ç–µ–∂–∏{% else %}–°–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π{% endif %}</h2>

{% if user.profile.role == 'employee' %}
<a href="{% url 'payment_create' %}" class="btn btn-success mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂</a>
{% endif %}

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>‚Ññ –ø–ª–∞—Ç–µ–∂–∞</th>
                <th>–ó–∞–∫–∞–∑</th>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–£—Å–ª—É–≥–∞</th>
                <th>–°—É–º–º–∞</th>
                <th>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã</th>
                {% if user.profile.role == 'employee' %}
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for payment in payments %}
            <tr>
                <td>{{ payment.id }}</td>
                <td>{{ payment.order.id }}</td>
                <td>{{ payment.order.client }}</td>
                <td>{{ payment.order.service }}</td>
                <td>
                    {% with total=payment.order.service.price|floatformat:2|default:0|stringformat:"f"|add:"0" %}
                    {% with discount=payment.order.discount|default:0|stringformat:"f"|add:"0" %}
                    {% with quantity=payment.order.quantity|stringformat:"f"|add:"0" %}
                    {{
                    total|floatformat:2|multiply:quantity|multiply:discount|divide:100|subtract:from:total|floatformat:2
                    }}
                    {% endwith %}
                    {% endwith %}
                    {% endwith %}
                </td>
                <td>{{ payment.date_paid }}</td>
                {% if user.profile.role == 'employee' %}
                <td>
                    <a href="{% url 'payment_update' payment.pk %}" class="btn btn-sm btn-primary">‚úèÔ∏è</a>
                    <a href="{% url 'payment_delete' payment.pk %}" class="btn btn-sm btn-danger">üóëÔ∏è</a>
                </td>
                {% endif %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="{% if user.profile.role == 'employee' %}7{% else %}6{% endif %}">–ü–ª–∞—Ç–µ–∂–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}