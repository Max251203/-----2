{% extends "main/base.html" %}
{% load custom_filters %}
{% block title %}–ó–∞–∫–∞–∑—ã{% endblock %}
{% block content %}
<h2>{% if user.profile.role == 'client' %}–ú–æ–∏ –∑–∞–∫–∞–∑—ã{% else %}–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤{% endif %}</h2>

{% if user.profile.role == 'employee' %}
<a href="{% url 'order_create' %}" class="btn btn-success mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</a>
{% endif %}

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                {% if user.profile.role == 'employee' %}<th>–ö–ª–∏–µ–Ω—Ç</th>{% endif %}
                <th>–£—Å–ª—É–≥–∞</th>
                <th>–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è</th>
                <th>–ö–æ–ª-–≤–æ</th>
                <th>–¶–µ–Ω–∞</th>
                <th>–°–∫–∏–¥–∫–∞</th>
                <th>–ò—Ç–æ–≥–æ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                {% if user.profile.role == 'employee' %}
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                {% if user.profile.role == 'employee' %}<td>{{ order.client }}</td>{% endif %}
                <td>{{ order.service }}</td>
                <td>{{ order.date_received }}</td>
                <td>{{ order.quantity }}</td>
                <td>{{ order.service.price }}</td>
                <td>{{ order.discount }}%</td>
                <td>
                    {% with total=order.service.price|floatformat:2|default:0|stringformat:"f"|add:"0" %}
                    {% with discount=order.discount|default:0|stringformat:"f"|add:"0" %}
                    {% with quantity=order.quantity|stringformat:"f"|add:"0" %}
                    {{ total|multiply:quantity|multiply:discount|divide:100|subtract_from:total|floatformat:2 }}
                    {% endwith %}
                    {% endwith %}
                    {% endwith %}
                </td>
                <td>
                    {% if order.date_executed %}
                    <span class="badge bg-success">–í—ã–ø–æ–ª–Ω–µ–Ω</span>
                    {% else %}
                    <span class="badge bg-warning">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                    {% endif %}
                </td>
                {% if user.profile.role == 'employee' %}
                <td>
                    <a href="{% url 'order_update' order.pk %}" class="btn btn-sm btn-primary">‚úèÔ∏è</a>
                    <a href="{% url 'order_delete' order.pk %}" class="btn btn-sm btn-danger">üóëÔ∏è</a>
                </td>
                {% endif %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="{% if user.profile.role == 'employee' %}9{% else %}8{% endif %}">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-4">
    <a href="{% url 'home' %}" class="btn btn-secondary">–ù–∞–∑–∞–¥</a>
</div>
{% endblock %}